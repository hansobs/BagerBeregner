<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hans Boller ‚Äì Beregner</title>
  <link rel="icon" type="image/png" href="hansboller.png" />
  <style>
    :root{
      --light-green:#b5ca8d;
      --mid-green:#8bb174;
      --teal:#426b69;
      --dark-blue:#222e50;
      --forest:#2a4849;
    }
    body{
      font-family:Inter,system-ui,sans-serif;
      background:#fdf7f0;
      color:var(--dark-blue);
      padding:3rem 1rem 5rem; /* extra space for bottom bar */
      display:flex;
      justify-content:center;
    }
    .container{
      width:100%;
      max-width:720px;
      background:#fffaf5;
      padding:2.5rem 2rem;
      border-radius:16px;
      box-shadow:0 4px 20px rgba(0,0,0,.15);
    }
    h1{
      text-align:center;
      color:var(--mid-green);
      font-size:1.9rem;
      margin:0.5rem 0 0.3rem;
    }
    .logo{
      display:flex;
      justify-content:center;
      margin-bottom:0.5rem;
    }
    .logo img{
      width:96px;
      height:96px;
      border-radius:20%;
      box-shadow:0 2px 6px rgba(0,0,0,0.15);
    }
    p.intro{
      text-align:center;
      color:var(--forest);
      font-size:.95rem;
      margin:0 0 1.8rem;
    }
    .group{
      background:rgba(181,202,141,.1);
      border:1px solid rgba(181,202,141,.4);
      border-radius:12px;
      padding:1rem 1.2rem;
      margin-bottom:1.5rem;
    }
    h3{
      color:var(--teal);
      margin:0 0 .6rem;
      border-bottom:2px solid var(--light-green);
      padding-bottom:.3rem;
      font-size:1.1rem;
    }
    label{
      display:block;
      margin-top:.8rem;
      font-weight:600;
      color:var(--forest);
      font-size:.95rem;
    }
    input,select{
      width:100%;
      padding:.65rem .75rem;
      margin-top:.35rem;
      border:1.5px solid var(--light-green);
      border-radius:10px;
      background:#f9faf7;
      color:var(--dark-blue);
      font-size:1rem;
      transition:border-color .2s;
    }
    input:focus,select:focus{
      border-color:var(--mid-green);
      outline:0;
      box-shadow:0 0 0 3px rgba(139,177,116,.25);
    }

    .flour-grid {
      display: grid;
      grid-template-columns: 80% 20%;
      gap: 10px;
      align-items: center;
      margin-top: .4rem;
    }
    .flour-grid input[type="text"] { width: 100%; }
    .pct-container {
      display: flex; align-items: center; justify-content: flex-end;
      background: #f9faf7;
      border: 1.5px solid var(--light-green);
      border-radius: 10px;
      padding-right: 0.6rem;
      transition: border-color 0.2s;
    }
    .pct-container:focus-within {
      border-color: var(--mid-green);
      box-shadow: 0 0 0 3px rgba(139,177,116,0.25);
    }
    .pct-container input {
      border: none; background: transparent;
      text-align: right; width: 100%;
      font-size: 1rem; padding: .55rem;
      color: var(--dark-blue);
    }
    .pct-container input:focus { outline: none; }
    .pct-container span { color: #6b7280; font-weight: 600; margin-left: 0.25rem; }

    table{width:100%;margin-top:1.5rem;border-collapse:collapse;background:#fefefe;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,.05)}
    thead{background:var(--teal);color:#fff}
    th,td{border-bottom:1px solid #e4e4e4;padding:.7rem;text-align:right}
    th:first-child,td:first-child{text-align:left}
    tfoot td{font-weight:700;background:var(--light-green);color:var(--forest)}

    .controls{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      margin-top:1rem;
    }
    #recipeName{flex:2;min-width:150px}
    #saveRecipe,#loadRecipe,#deleteRecipe{flex:1;min-width:110px}
    button{
      background:var(--mid-green);
      color:#fff;
      border:0;
      padding:.6rem 1rem;
      border-radius:8px;
      font-weight:700;
      cursor:pointer;
      transition:background .2s;
    }
    button:hover{background:var(--teal)}
    .sum-line{display:flex;align-items:center;justify-content:flex-end;margin-top:.35rem;gap:.5rem}
    .badge{display:inline-block;min-width:76px;text-align:center;padding:.2rem .55rem;border-radius:999px;font-weight:700;font-size:.85rem;background:#eef6e6;color:#1f2937;border:1px solid rgba(181,202,141,.8)}
    .badge.bad{background:#ffecec;color:#7f1d1d;border-color:#ef9a9a}
    #deleteRecipe { background:#e5e5e5; color:#333; }
    #deleteRecipe:hover { background:#c94c4c; color:#fff; }

    /* Sticky bottom bar */
    .bottom-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--forest);
      color: #fff;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: .6rem .8rem;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.15);
      z-index: 100;
    }
    .bottom-bar button {
      flex: 1;
      margin: 0 .3rem;
      padding: .7rem .5rem;
      background: var(--mid-green);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      font-size: 1rem;
    }
    .bottom-bar button:hover {
      background: var(--teal);
    }

    /* -------- MOBILE RESPONSIVENESS -------- */
    @media (max-width: 640px) {
      body { padding: 1rem 1rem 5rem; }
      .container {
        padding: 1.5rem 1rem;
        box-shadow: 0 2px 10px rgba(0,0,0,.1);
      }
      h1 { font-size: 1.5rem; }
      p.intro { font-size: .9rem; }
      input, select, button {
        font-size: .95rem;
        padding: .55rem .7rem;
      }
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      .controls > * {
        width: 100%;
      }
      .flour-grid {
        grid-template-columns: 1fr;
      }
      .logo img { width:72px; height:72px; }
    }

    @media (min-width: 641px) {
      .bottom-bar { display: none; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="hansboller.png" alt="Hans Boller logo" />
    </div>
    <h1>Hans Boller ‚Äì Beregner</h1>
    <p class="intro">Indtast √∏nsket dejv√¶gt ‚Äì beregningen tager h√∏jde for hydrering og surdej automatisk.</p>

    <div class="group">
      <label>√ònsket samlet dejv√¶gt (gram)</label>
      <input type="number" id="totalTarget" value="1000" />
    </div>

    <div class="group">
      <h3>Melblanding (i alt = 100 %)</h3>
      <div class="flour-grid">
        <input type="text" id="flour1name" value="Hvedemel" />
        <div class="pct-container">
          <input type="number" id="flour1pct" value="45" step="0.1" min="0" max="100" />
          <span>%</span>
        </div>
      </div>
      <div class="flour-grid">
        <input type="text" id="flour2name" value="Manitoba" />
        <div class="pct-container">
          <input type="number" id="flour2pct" value="35" step="0.1" min="0" max="100" />
          <span>%</span>
        </div>
      </div>
      <div class="flour-grid">
        <input type="text" id="flour3name" value="Fuldkornsmel" />
        <div class="pct-container">
          <input type="number" id="flour3pct" value="20" step="0.1" min="0" max="100" />
          <span>%</span>
        </div>
      </div>
      <div class="sum-line">
        <span style="opacity:.8">Sum af melprocenter:</span>
        <span id="flourSumBadge" class="badge">100.0 %</span>
      </div>
      <button id="addFlour" style="margin-top:.8rem; background:var(--light-green); color:var(--forest);">
        ‚ûï Tilf√∏j meltype
      </button>
    </div>

    <div class="group">
      <h3>Dejparametre</h3>
      <label>Hydrering (%)</label>
      <input type="number" id="hydration" value="80" step="0.1" />
      <label>Surdej (% af mel)</label>
      <input type="number" id="sourdoughPct" value="20" step="0.1" />
      <label>Surdejs hydrering (%)</label>
      <input type="number" id="starterHydration" value="100" step="1" />
      <label>Salt (% af mel)</label>
      <input type="number" id="saltPct" value="2.5" step="0.1" />
      <label>G√¶rtype</label>
      <select id="yeastType">
        <option value="none">Ingen g√¶r (kun surdej)</option>
        <option value="dry">T√∏rg√¶r</option>
        <option value="fresh">Frisk g√¶r</option>
      </select>
    </div>

    <div class="controls">
      <input type="text" id="recipeName" placeholder="Opskriftnavn (f.eks. 'Boller ‚Äì 80% hydreret')" />
      <button id="saveRecipe">Gem</button>
      <select id="loadRecipe"><option value="">Indl√¶s...</option></select>
      <button id="deleteRecipe" style="background:#c94c4c;">üóëÔ∏è Slet</button>
    </div>

    <table id="results">
      <thead><tr><th>Ingrediens</th><th>V√¶gt (g)</th></tr></thead>
      <tbody></tbody>
      <tfoot><tr><td>Reel dejv√¶gt</td><td id="totalWeight"></td></tr></tfoot>
    </table>

    <div style="margin-top:1rem; text-align:right;">
      <button id="copyRecipe" style="background:var(--teal);">üìã Kopi√©r opskrift</button>
      <span id="copyMsg" style="margin-left:10px; opacity:0; color:var(--teal); transition:opacity .3s;">Opskrift kopieret!</span>
    </div>
  </div>

    <div class="bottom-bar">
      <button id="mobileSave">üíæ Gem</button>
      <button id="mobileCopy">üìã Kopi√©r</button>
    </div>

  <script>
    const inputs=document.querySelectorAll("input, select");
    const tbody=document.querySelector("#results tbody");
    const totalWeightCell=document.querySelector("#totalWeight");
    const loadSelect=document.getElementById("loadRecipe");
    const flourSumBadge=document.getElementById("flourSumBadge");

    function flourSum(){
      const sum=[...document.querySelectorAll('.flour-grid input[type=number]')]
        .map(i=>+i.value||0)
        .reduce((a,b)=>a+b,0);
      flourSumBadge.textContent=sum.toFixed(1)+" %";
      flourSumBadge.classList.toggle("bad",Math.abs(sum-100)>0.05);
      return sum;
    }

    function calc(){
      const target = +document.getElementById("totalTarget").value||0;
      const h=(+document.getElementById("hydration").value||0)/100;
      const s=(+document.getElementById("sourdoughPct").value||0)/100;
      const hs=(+document.getElementById("starterHydration").value||0)/100;
      const saltPct=(+document.getElementById("saltPct").value||0)/100;
      const yeastType=document.getElementById("yeastType").value;
      let yeastPct=0;
      if(yeastType==="dry")yeastPct=0.0037;
      if(yeastType==="fresh")yeastPct=0.015;

      // Step 1: Base system (ignores salt/yeast)
      const totalFlour = target / (1 + h);
      const totalWater = h * totalFlour;
      const sourdough = totalFlour * s;
      const sourFlour = sourdough / (1 + hs);
      const sourWater = sourdough - sourFlour;
      const directFlour = totalFlour - sourFlour;
      const directWater = totalWater - sourWater;

      // Step 2: Add-ons
      const salt = totalFlour * saltPct;
      const yeast = totalFlour * yeastPct;
      const finalTotal = totalFlour + totalWater + salt + yeast;

      const flours=[...document.querySelectorAll(".flour-grid")].map(f=>({
        name:f.querySelector('input[type=text]').value,
        pct:+f.querySelector('input[type=number]').value||0
      })).filter(f=>f.pct>0);

      tbody.innerHTML="";
      const sum=flours.reduce((a,f)=>a+f.pct,0)||1;
      flours.forEach(f=>{
        const flourWeight=directFlour*(f.pct/sum);
        tbody.innerHTML+=`<tr><td>${f.name}</td><td>${flourWeight.toFixed(1)}</td></tr>`;
      });
      tbody.innerHTML+=`
        <tr><td>Vand</td><td>${directWater.toFixed(1)}</td></tr>
        <tr><td>Surdej</td><td>${sourdough.toFixed(1)} (‚âà ${sourFlour.toFixed(1)} mel + ${sourWater.toFixed(1)} vand)</td></tr>
        <tr><td>Salt</td><td>${salt.toFixed(1)}</td></tr>`;
      if(yeastType!=="none"){
        tbody.innerHTML+=`<tr><td>G√¶r (${yeastType==="fresh"?"frisk":"t√∏r"})</td><td>${yeast.toFixed(1)}</td></tr>`;
      }
      totalWeightCell.textContent=finalTotal.toFixed(1);
      flourSum();
    }

    function saveRecipe() {
    const name = document.getElementById("recipeName").value.trim();
    if (!name) return alert("Navngiv opskriften f√∏rst!");
    const recipe = {};
    document.querySelectorAll("input, select").forEach(el => {
        if (el.id && el.id !== "recipeName") recipe[el.id] = el.value;
    });
    const key = "bakerman_" + name;
    localStorage.setItem(key, JSON.stringify(recipe));
    updateRecipeList(name);           // pass the name we just saved
    loadSelect.value = key;           // auto-select in dropdown
    showToast(`Opskriften "${name}" er gemt!`);
    }


    function loadRecipe() {
    const key = loadSelect.value;
    if (!key) return;
    const recipe = JSON.parse(localStorage.getItem(key) || "null");
    if (!recipe) return;
    Object.entries(recipe).forEach(([id, val]) => {
        const el = document.getElementById(id);
        if (el) el.value = val;
    });
    calc();
    // update name field for clarity
    document.getElementById("recipeName").value = key.replace("bakerman_", "");
    }


    function deleteRecipe() {
    let key = loadSelect.value; // try dropdown first
    if (!key) {
        // fallback: try the name field
        const name = document.getElementById("recipeName").value.trim();
        if (name) {
        const guess = "bakerman_" + name;
        if (localStorage.getItem(guess)) key = guess;
        }
    }
    if (!key) return alert("V√¶lg f√∏rst en opskrift, der skal slettes.");

    const recipeName = key.replace("bakerman_", "");
    if (confirm(`Er du sikker p√•, at du vil slette opskriften "${recipeName}"?`)) {
        localStorage.removeItem(key);
        updateRecipeList();
        document.getElementById("recipeName").value = "";
        loadSelect.value = "";
        alert(`Opskriften "${recipeName}" er slettet.`);
    }
    }

    function showToast(msg, color = "var(--teal)") {
    const toast = document.createElement("div");
    toast.textContent = msg;
    toast.style.position = "fixed";
    toast.style.bottom = "20px";
    toast.style.right = "20px";
    toast.style.background = color;
    toast.style.color = "#fff";
    toast.style.padding = "10px 15px";
    toast.style.borderRadius = "8px";
    toast.style.boxShadow = "0 2px 6px rgba(0,0,0,.2)";
    toast.style.zIndex = "1000";
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2000);
    }

    function updateRecipeList(selectName = "") {
    const prev = loadSelect.value;    // remember current selection
    loadSelect.innerHTML = `<option value="">Indl√¶s...</option>`;
    const keys = Object.keys(localStorage)
        .filter(k => k.startsWith("bakerman_"))
        .sort();
    keys.forEach(k => {
        const opt = document.createElement("option");
        opt.value = k;
        opt.textContent = k.replace("bakerman_", "");
        loadSelect.appendChild(opt);
    });

    // prefer selecting the provided name, else keep previous selection
    const preferredKey = selectName ? "bakerman_" + selectName : prev;
    if (preferredKey && keys.includes(preferredKey)) {
        loadSelect.value = preferredKey;
    }
    }

    document.getElementById("addFlour").addEventListener("click",()=>{
      const group=document.querySelector(".group:nth-of-type(2)");
      const rows=group.querySelectorAll(".flour-grid").length;
      if(rows>=6)return alert("Maks 6 meltyper!");
      const idx=rows+1;
      const div=document.createElement("div");
      div.className="flour-grid";
      div.innerHTML=`
        <input type="text" id="flour${idx}name" value="Meltype ${idx}" />
        <div class="pct-container">
          <input type="number" id="flour${idx}pct" value="0" step="0.1" min="0" max="100" />
          <span>%</span>
        </div>`;
      group.insertBefore(div,group.querySelector(".sum-line"));
      div.querySelectorAll("input").forEach(i=>i.addEventListener("input",calc));
      calc();
    });

    document.getElementById("copyRecipe").addEventListener("click",()=>{
      let txt=`üßæ ${document.getElementById("recipeName").value||"Uden navn"}\n`;
      txt+=`Hydrering: ${document.getElementById("hydration").value}%\n`;
      txt+=`Surdej: ${document.getElementById("sourdoughPct").value}% (${document.getElementById("starterHydration").value}% hydrering)\n`;
      txt+=`Salt: ${document.getElementById("saltPct").value}%\n`;
      txt+=`G√¶r: ${document.getElementById("yeastType").value==="none"?"Ingen":document.getElementById("yeastType").value}\n\n`;
      txt+=`Melblanding:\n`;
      document.querySelectorAll(".flour-grid").forEach(f=>{
        const name=f.querySelector('input[type=text]').value;
        const pct=f.querySelector('input[type=number]').value;
        txt+=` - ${name}: ${pct}%\n`;
      });
      txt+=`\nIngredienser:\n`;
      document.querySelectorAll("#results tbody tr").forEach(r=>{
        txt+=` - ${r.children[0].textContent}: ${r.children[1].textContent} g\n`;
      });
      navigator.clipboard.writeText(txt).then(()=>{
        const msg=document.getElementById("copyMsg");
        msg.style.opacity=1;
        setTimeout(()=>msg.style.opacity=0,1500);
      });
    });

    document.getElementById("saveRecipe").addEventListener("click", saveRecipe);
    document.getElementById("loadRecipe").addEventListener("change", loadRecipe);
    document.getElementById("deleteRecipe").addEventListener("click", deleteRecipe);
    inputs.forEach(i=>i.addEventListener("input",calc));
    updateRecipeList();
    calc();

    document.getElementById("mobileSave").addEventListener("click", () => {
      document.getElementById("saveRecipe").click();
    });
    document.getElementById("mobileCopy").addEventListener("click", () => {
      document.getElementById("copyRecipe").click();
    });
  </script>
</body>
</html>
