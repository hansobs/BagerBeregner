<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hans Boller ‚Äì Beregner</title>
  <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/hansobs/BagerBeregner/main/hansboller.png" />
  <style>
    /* --- Dracula Theme Variables --- */
    :root {
      --background: #282a36;
      --current-line: #44475a;
      --foreground: #f8f8f2;
      --comment: #6272a4;
      --cyan: #8be9fd;
      --green: #50fa7b;
      --orange: #ffb86c;
      --pink: #ff79c6;
      --purple: #bd93f9;
      --red: #ff5555;
      --yellow: #f1fa8c;
    }
  
    body {
      font-family: Inter, system-ui, sans-serif;
      background: var(--background);
      color: var(--foreground);
      padding: 3rem 1rem 5rem;
      display: flex;
      justify-content: center;
    }
  
    .container {
      width: 100%;
      max-width: 720px;
      background: var(--current-line);
      padding: 2.5rem 2rem;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
  
    /* Logo */
    .logo {
      display: flex;
      justify-content: center;
      margin-bottom: 0.5rem;
    }

    .logo img {
      width: 96px;
      height: 96px;
      max-width: 96px;
      object-fit: cover;
      display: block;
      border-radius: 20%;
      box-shadow: 0 0 10px rgba(255,255,255,0.15);
    }
  
    h3 {
      color: var(--cyan);
      margin: 0 0 .6rem;
      border-bottom: 2px solid var(--purple);
      padding-bottom: .3rem;
      font-size: 1.1rem;
    }
  
    label {
      display: block;
      margin-top: .8rem;
      font-weight: 600;
      color: var(--yellow);
      font-size: .95rem;
    }
  
    input, select, textarea {
      width: 100%;
      padding: .65rem .75rem;
      margin-top: .35rem;
      border: 1.5px solid var(--purple);
      border-radius: 10px;
      background: #3b3d4f;
      color: var(--foreground);
      font-size: 1rem;
      font-family: inherit; /* Ensures textarea uses the same font */
      transition: border-color .2s, background .2s;
    }

    textarea {
        resize: vertical;
    }
  
    input:focus, select:focus, textarea:focus {
      border-color: var(--green);
      outline: 0;
      box-shadow: 0 0 0 3px rgba(80,250,123,0.25);
    }
  
    .flour-grid {
      display: grid;
      grid-template-columns: 80% 20%;
      gap: 10px;
      align-items: center;
      margin-top: .4rem;
    }
  
    .pct-container {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      background: #3b3d4f;
      border: 1.5px solid var(--purple);
      border-radius: 10px;
      padding-right: 0.6rem;
    }
  
    .pct-container input {
      border: none;
      background: transparent;
      text-align: right;
      width: 100%;
      font-size: 1rem;
      padding: .55rem;
      color: var(--foreground);
    }
  
    .pct-container span {
      color: var(--comment);
      font-weight: 600;
      margin-left: 0.25rem;
    }
  
    table {
      width: 100%;
      margin-top: 1.5rem;
      border-collapse: collapse;
      background: #353746;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
  
    thead {
      background: var(--purple);
      color: var(--background);
    }
  
    th, td {
      border-bottom: 1px solid #44475a;
      padding: .7rem;
      text-align: right;
    }
  
    th:first-child, td:first-child { text-align: left; }
    tfoot td {
      font-weight: 700;
      background: var(--pink);
      color: var(--background);
    }
  
    button {
      background: var(--green);
      color: var(--background);
      border: 0;
      padding: .6rem 1rem;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: background .2s;
    }
  
    button:hover {
      background: var(--cyan);
    }
  
    #deleteRecipe {
      background: var(--red);
      color: var(--background);
    }
  
    #deleteRecipe:hover {
      background: #ff6b6b;
    }
  
    .sum-line {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      margin-top: .35rem;
      gap: .5rem;
    }
  
    .badge {
      display: inline-block;
      min-width: 76px;
      text-align: center;
      padding: .2rem .55rem;
      border-radius: 999px;
      font-weight: 700;
      font-size: .85rem;
      background: var(--purple);
      color: var(--foreground);
      border: 1px solid var(--cyan);
    }
  
    .badge.bad {
      background: var(--red);
      color: var(--background);
    }
  
    /* Mobile bottom-bar removed */
  
    @media (max-width: 640px) {
      body { padding: 1rem 1rem 5rem; }
      .container { padding: 1.5rem 1rem; }
      h1 { font-size: 1.5rem; }
      p.intro { font-size: .9rem; }
      .controls { flex-direction: column; align-items: stretch; }
      .controls > * { width: 100%; }
      .flour-grid { grid-template-columns: 1fr; }
      .logo img { width:72px; height:72px; }
    }
  
    /* Removed mobile bottom-bar styles */
  </style>
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#282a36" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Hans Boller">
  <link rel="apple-touch-icon" href="https://bohnsvendsen.dk/hansboller/hansboller.png">
  
  <script>
  // Register the service worker
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
            .then(() => console.log('‚úÖ Service Worker registered'))
            .catch(err => console.warn('SW registration failed:', err));
    });
  }
</script>
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="https://raw.githubusercontent.com/hansobs/BagerBeregner/main/hansboller.png" alt="Hans Boller logo" />
    </div>
    <h1>Hans Boller ‚Äì Beregner</h1>
    <p class="intro">Indtast √∏nsket dejv√¶gt ‚Äì beregningen tager h√∏jde for hydrering og surdej automatisk.</p>
    <div class="group">
      <label>√ònsket samlet dejv√¶gt (gram)</label>
      <input type="number" id="totalTarget" value="1000" />
    </div>
  
    <div class="group">
      <h3>Melblanding (i alt = 100 %)</h3>
      <div class="flour-grid">
        <input type="text" id="flour1name" value="Hvedemel" />
        <div class="pct-container">
          <input type="number" id="flour1pct" value="45" step="0.1" min="0" max="100" />
          <span>%</span>
        </div>
      </div>
      <div class="flour-grid">
        <input type="text" id="flour2name" value="Manitoba" />
        <div class="pct-container">
          <input type="number" id="flour2pct" value="35" step="0.1" min="0" max="100" />
          <span>%</span>
        </div>
      </div>
      <div class="flour-grid">
        <input type="text" id="flour3name" value="Fuldkornsmel" />
        <div class="pct-container">
          <input type="number" id="flour3pct" value="20" step="0.1" min="0" max="100" />
          <span>%</span>
        </div>
      </div>
      <div class="sum-line">
        <span style="opacity:.8">Sum af melprocenter:</span>
        <span id="flourSumBadge" class="badge">100.0 %</span>
      </div>
      <button id="addFlour" style="margin-top:.8rem;">
        ‚ûï Tilf√∏j meltype
      </button>
    </div>
  
    <div class="group">
      <h3>Dejparametre</h3>
      <label>Hydrering (%)</label>
      <input type="number" id="hydration" value="80" step="0.1" />
      <label>Surdej (% af mel)</label>
      <input type="number" id="sourdoughPct" value="20" step="0.1" />
      <label>Surdejs hydrering (%)</label>
      <input type="number" id="starterHydration" value="100" step="1" />
      <label>Salt (% af mel)</label>
      <input type="number" id="saltPct" value="2.5" step="0.1" />
      <label>G√¶rtype</label>
      <select id="yeastType">
        <option value="none">Ingen g√¶r (kun surdej)</option>
        <option value="dry">T√∏rg√¶r</option>
        <option value="fresh">Frisk g√¶r</option>
      </select>
    </div>

    <div class="group">
        <h3>Bagning & Noter</h3>
        <label>Ovn Temperatur (¬∞C)</label>
        <input type="number" id="ovenTemp" value="230" step="5" />
  
        <label>Ovntype</label>
        <select id="ovenSetting">
          <option value="convection">Varmluft</option>
          <option value="top-bottom">Over/undervarme</option>
          <option value="steam">Dampovn</option>
          <option value="other">Andet</option>
        </select>
  
        <label>Noter (f.eks. bagetid, fremgangsm√•de)</label>
        <textarea id="notes" rows="4" placeholder="Fx: Bagt i 20 minutter ved 230¬∞C, derefter 15 minutter ved 210¬∞C."></textarea>
    </div>
  
    <div class="controls">
      <input type="text" id="recipeName" placeholder="Opskriftnavn (f.eks. 'Boller ‚Äì 80% hydreret')" />
      <button id="saveRecipe">Gem</button>
      <select id="loadRecipe"><option value="">Indl√¶s...</option></select>
      <button id="deleteRecipe">üóëÔ∏è Slet</button>
    </div>
  
    <table id="results">
      <thead><tr><th>Ingrediens</th><th>V√¶gt (g)</th></tr></thead>
      <tbody></tbody>
      <tfoot><tr><td>Reel dejv√¶gt</td><td id="totalWeight"></td></tr></tfoot>
    </table>
  
    <div style="margin-top:1rem; text-align:right;">
      <button id="copyRecipe">üìã Kopi√©r opskrift</button>
      <span id="copyMsg" style="margin-left:10px; opacity:0; color:var(--green); transition:opacity .3s;">Opskrift kopieret!</span>
    </div>
  </div>
  
    <!-- Mobile bottom bar removed -->
  
  <script>
    const inputs = document.querySelectorAll("input, select, textarea"); // Added textarea
    const tbody = document.querySelector("#results tbody");
    const totalWeightCell = document.querySelector("#totalWeight");
    const loadSelect = document.getElementById("loadRecipe");
    const flourSumBadge = document.getElementById("flourSumBadge");
  
    function flourSum(){
      const sum=[...document.querySelectorAll('.flour-grid input[type=number]')]
        .map(i=>+i.value||0)
        .reduce((a,b)=>a+b,0);
      flourSumBadge.textContent=sum.toFixed(1)+" %";
      flourSumBadge.classList.toggle("bad",Math.abs(sum-100)>0.05);
      return sum;
    }
  
    function calc(){
      const target = +document.getElementById("totalTarget").value||0;
      const h=(+document.getElementById("hydration").value||0)/100;
      const s=(+document.getElementById("sourdoughPct").value||0)/100;
      const hs=(+document.getElementById("starterHydration").value||0)/100;
      const saltPct=(+document.getElementById("saltPct").value||0)/100;
      const yeastType=document.getElementById("yeastType").value;
      let yeastPct=0;
      if(yeastType==="dry")yeastPct=0.0037;
      if(yeastType==="fresh")yeastPct=0.015;
  
      // Step 1: Base system (ignores salt/yeast)
      const totalFlour = target / (1 + h);
      const totalWater = h * totalFlour;
      const sourdough = totalFlour * s;
      const sourFlour = sourdough / (1 + hs);
      const sourWater = sourdough - sourFlour;
      const directFlour = totalFlour - sourFlour;
      const directWater = totalWater - sourWater;
  
      // Step 2: Add-ons
      const salt = totalFlour * saltPct;
      const yeast = totalFlour * yeastPct;
      const finalTotal = totalFlour + totalWater + salt + yeast;
  
      const flours=[...document.querySelectorAll(".flour-grid")].map(f=>({
        name:f.querySelector('input[type=text]').value,
        pct:+f.querySelector('input[type=number]').value||0
      })).filter(f=>f.pct>0);
  
      tbody.innerHTML="";
      const sum=flours.reduce((a,f)=>a+f.pct,0)||1;
      flours.forEach(f=>{
        const flourWeight=directFlour*(f.pct/sum);
        tbody.innerHTML+=`<tr><td>${f.name}</td><td>${flourWeight.toFixed(1)}</td></tr>`;
      });
      tbody.innerHTML+=`
        <tr><td>Vand</td><td>${directWater.toFixed(1)}</td></tr>
        <tr><td>Surdej</td><td>${sourdough.toFixed(1)} (‚âà ${sourFlour.toFixed(1)} mel + ${sourWater.toFixed(1)} vand)</td></tr>
        <tr><td>Salt</td><td>${salt.toFixed(1)}</td></tr>`;
      if(yeastType!=="none"){
        tbody.innerHTML+=`<tr><td>G√¶r (${yeastType==="fresh"?"frisk":"t√∏r"})</td><td>${yeast.toFixed(1)}</td></tr>`;
      }
      totalWeightCell.textContent=finalTotal.toFixed(1);
      flourSum();
    }
  
    function saveRecipe() {
        const name = document.getElementById("recipeName").value.trim();
        if (!name) return alert("Navngiv opskriften f√∏rst!");
        
        const recipe = {};
        // This now includes textarea automatically
        document.querySelectorAll("input, select, textarea").forEach(el => {
            if (el.id && el.id !== "recipeName") {
                recipe[el.id] = el.value;
            }
        });
        
        const key = "bakerman_" + name;
        localStorage.setItem(key, JSON.stringify(recipe));
        updateRecipeList(name);
        loadSelect.value = key;
        showToast(`Opskriften "${name}" er gemt!`);
    }
  
    function loadRecipe() {
        const key = loadSelect.value;
        if (!key) return;
        
        const recipe = JSON.parse(localStorage.getItem(key) || "null");
        if (!recipe) return;
        
        // This now includes textarea automatically
        Object.entries(recipe).forEach(([id, val]) => {
            const el = document.getElementById(id);
            if (el) el.value = val;
        });
        
        calc();
        document.getElementById("recipeName").value = key.replace("bakerman_", "");
    }
  
    function deleteRecipe() {
        let key = loadSelect.value;
        if (!key) {
            const name = document.getElementById("recipeName").value.trim();
            if (name) {
                const guess = "bakerman_" + name;
                if (localStorage.getItem(guess)) key = guess;
            }
        }
        if (!key) return alert("V√¶lg f√∏rst en opskrift, der skal slettes.");
  
        const recipeName = key.replace("bakerman_", "");
        if (confirm(`Er du sikker p√•, at du vil slette opskriften "${recipeName}"?`)) {
            localStorage.removeItem(key);
            updateRecipeList();
            document.getElementById("recipeName").value = "";
            loadSelect.value = "";
            alert(`Opskriften "${recipeName}" er slettet.`);
        }
    }
  
    function showToast(msg, color = "var(--green)") {
        const toast = document.createElement("div");
        toast.textContent = msg;
        toast.style.position = "fixed";
        toast.style.bottom = "20px";
        toast.style.right = "20px";
        toast.style.background = color;
        toast.style.color = "var(--background)";
        toast.style.padding = "10px 15px";
        toast.style.borderRadius = "8px";
        toast.style.boxShadow = "0 2px 6px rgba(0,0,0,.2)";
        toast.style.zIndex = "1000";
        toast.style.fontWeight = "600";
        document.body.appendChild(toast);
        setTimeout(() => {
            toast.style.opacity = '0';
            toast.addEventListener('transitionend', () => toast.remove());
        }, 2000);
    }
  
    function updateRecipeList(selectName = "") {
        const prev = loadSelect.value;
        loadSelect.innerHTML = `<option value="">Indl√¶s...</option>`;
        const keys = Object.keys(localStorage)
            .filter(k => k.startsWith("bakerman_"))
            .sort();
        keys.forEach(k => {
            const opt = document.createElement("option");
            opt.value = k;
            opt.textContent = k.replace("bakerman_", "");
            loadSelect.appendChild(opt);
        });
  
        const preferredKey = selectName ? "bakerman_" + selectName : prev;
        if (preferredKey && keys.includes(preferredKey)) {
            loadSelect.value = preferredKey;
        }
    }
  
    document.getElementById("addFlour").addEventListener("click",()=>{
        // V√¶lg 'Melblanding' gruppen robust ved at bruge array-index p√• .group
        const groups = document.querySelectorAll('.group');
        const group = groups[1]; // 0-based: 0=√ònsket dejv√¶gt, 1=Melblanding
        if(!group) return;
        const rows = group.querySelectorAll(".flour-grid").length;
        if(rows>=6) return alert("Maks 6 meltyper!");
        const idx = rows+1;
        const div = document.createElement("div");
        div.className = "flour-grid";
        div.innerHTML = `
        <input type="text" id="flour${idx}name" value="Meltype ${idx}" />
        <div class="pct-container">
          <input type="number" id="flour${idx}pct" value="0" step="0.1" min="0" max="100" />
          <span>%</span>
        </div>`;
        group.insertBefore(div, group.querySelector(".sum-line"));
        div.querySelectorAll("input").forEach(i=>i.addEventListener("input",calc));
        calc();
    });
  
    document.getElementById("copyRecipe").addEventListener("click",()=>{
        let txt=`üßæ ${document.getElementById("recipeName").value||"Uden navn"}\n---\n`;
        txt+=`Hydrering: ${document.getElementById("hydration").value}%\n`;
        txt+=`Surdej: ${document.getElementById("sourdoughPct").value}% (${document.getElementById("starterHydration").value}% hydrering)\n`;
        txt+=`Salt: ${document.getElementById("saltPct").value}%\n`;
        const yeastEl = document.getElementById("yeastType");
        txt+=`G√¶r: ${yeastEl.options[yeastEl.selectedIndex].text}\n\n`;
        
        txt+=`Melblanding:\n`;
        document.querySelectorAll(".flour-grid").forEach(f=>{
            const name=f.querySelector('input[type=text]').value;
            const pct=f.querySelector('input[type=number]').value;
            if (parseFloat(pct) > 0) {
              txt+=` - ${name}: ${pct}%\n`;
            }
        });

        txt+=`\nIngredienser:\n`;
        document.querySelectorAll("#results tbody tr").forEach(r=>{
            txt+=` - ${r.children[0].textContent}: ${r.children[1].textContent.replace(/ \(.*/, '')} g\n`; // Removes detail part like (‚âà ... mel)
        });

        // *** NY KODE TIL AT KOPIERE BAGNINGSINFO ***
        const ovenTemp = document.getElementById("ovenTemp").value;
        const ovenSettingEl = document.getElementById("ovenSetting");
        const ovenSetting = ovenSettingEl.options[ovenSettingEl.selectedIndex].text;
        const notes = document.getElementById("notes").value.trim();

        txt+=`\nBagning:\n`;
        txt+=` - Temperatur: ${ovenTemp}¬∞C\n`;
        txt+=` - Ovntype: ${ovenSetting}\n`;

        if (notes) {
          txt+=`\nNoter:\n${notes}\n`;
        }
        // *** SLUT P√Ö NY KODE ***

        navigator.clipboard.writeText(txt).then(()=>{
            const msg=document.getElementById("copyMsg");
            msg.style.opacity=1;
            setTimeout(()=>msg.style.opacity=0,1500);
        });
    });
  
    document.getElementById("saveRecipe").addEventListener("click", saveRecipe);
    document.getElementById("loadRecipe").addEventListener("change", loadRecipe);
    document.getElementById("deleteRecipe").addEventListener("click", deleteRecipe);
    inputs.forEach(i=>i.addEventListener("input",calc));
    
  // Mobile bottom bar removed ‚Äî no mobileSave/mobileCopy handlers

    // Initial load
    updateRecipeList();
    calc();
  </script>
</body>
</html>
